Options -Indexes 
ErrorDocument 404 /404.php


	php_flag allow_call_time_pass_reference 1
	php_flag session.use_trans_sid off

	#php_value display_errors 1

	#php_value mbstring.internal_encoding UTF-8


<IfModule mod_rewrite.c>
	Options +FollowSymLinks
	RewriteEngine On

#Add by REDZ.RU
	RewriteBase /
	RewriteCond %{ENV:HTTPS} !on
	RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
	RewriteCond %{HTTP_HOST} ^www\.(.*) [NC]
	RewriteRule ^(.*)$ https://%1/$1 [R=301,L]

	RewriteCond %{REQUEST_FILENAME} !-f
	RewriteCond %{REQUEST_FILENAME} !-l
	RewriteCond %{REQUEST_FILENAME} !-d
	RewriteCond %{REQUEST_FILENAME} !/bitrix/urlrewrite.php$
	RewriteRule ^(.*)$ /bitrix/urlrewrite.php [L]
	RewriteRule .* - [E=REMOTE_USER:%{HTTP:Authorization}]

	#MICHAEL
  #без www
#RewriteCond %{HTTP_HOST} ^www\.(.*) [NC]
  #RewriteRule ^(.*)$ https://%1/$1 [R=301,L]

  # на https
  #RewriteCond %{ENV:HTTPS} !on
  #RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

  RewriteCond %{REQUEST_URI} \..+$
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteCond %{REQUEST_FILENAME} -f
  RewriteCond %{REQUEST_URI} ^(.+)/$
  RewriteRule ^(.+)/$ /$1 [R=301,L]
  RewriteCond %{REQUEST_URI} !(.*)/$
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_URI} !\..+$
  RewriteRule ^(.*)$ $1/ [L,R=301]

	RewriteCond %{THE_REQUEST} ^[A-Z]{3,9}\ /index\.php\ HTTP/ 
	RewriteRule ^index\.php$ https://on-trip.ru [R=301,L]

	RewriteCond %{THE_REQUEST} ^[A-Z]{3,9}\ /index\.html\ HTTP/ 
	RewriteRule ^index\.php$ https://on-trip.ru [R=301,L]


	#RewriteCond %{REQUEST_FILENAME} !-d
	#RewriteCond %{REQUEST_URI} ^(.+)/$
	#RewriteRule ^(.+)/$ /$1 [R=301,L]


  


  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-l
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteCond %{REQUEST_URI} ^(.*/[^/\.]+)$
  RewriteRule ^(.*)$ https://%{HTTP_HOST}/$1/ [R=301,L]

</IfModule>


<ifModule mod_deflate.c>
  <IfModule mod_filter.c>
      AddOutputFilterByType DEFLATE text/plain text/html
      AddOutputFilterByType DEFLATE text/css
      AddOutputFilterByType DEFLATE text/javascript application/javascript application/x-javascript
      AddOutputFilterByType DEFLATE text/xml application/xml application/xhtml+xml application/rss+xml
      AddOutputFilterByType DEFLATE application/javascript
      AddOutputFilterByType DEFLATE text/javascript
      AddOutputFilterByType DEFLATE application/json
      AddOutputFilterByType DEFLATE application/javascript
      AddOutputFilterByType DEFLATE application/x-javascript
      AddOutputFilterByType DEFLATE application/vnd.ms-fontobject application/x-font-ttf font/opentype image/svg+xml image/x-icon
  </ifModule>
  
</ifModule>


<IfModule mod_expires.c>
    # Enable expires
    ExpiresActive On
    
    # Default a cache expiration
    ExpiresDefault "access plus 10 month"
    
    # Images
    ExpiresByType image/gif                 "access plus 7 day"
    ExpiresByType image/png                 "access plus 7 day"
    ExpiresByType image/jpg                 "access plus 7 day"
    ExpiresByType image/jpeg                "access plus 7 day"
    
    # CSS, JavaScript
    ExpiresByType text/css                  "access plus 7 day"
    ExpiresByType text/javascript           "access plus 7 day"
    ExpiresByType application/javascript    "access plus 7 day"
    ExpiresByType application/x-javascript  "access plus 7 day"

    # Включаем кэширование xml файлов на десять минут
    ExpiresByType application/xhtml+xml "access plus 600 seconds"
     
    # Нестандартные шрифты сайта 
    ExpiresByType application/x-font-ttf "access plus 1 month"
    ExpiresByType font/opentype "access plus 1 month"
    ExpiresByType application/x-font-woff "access plus 1 month"
    ExpiresByType image/svg+xml "access plus 1 month"
    ExpiresByType application/vnd.ms-fontobject "access plus 1 month"

</IfModule>


<ifModule mod_headers.c>
  <filesMatch "\.(ico|pdf|flv|jpg|jpeg|png|gif|swf)$">
  Header set Cache-Control "max-age=2592000, public"
  </filesMatch>
  <filesMatch "\.(css|js)$">
  Header set Cache-Control "max-age=2592000, public"
  </filesMatch>
  <filesMatch "\.(xml|txt)$">
  Header set Cache-Control "max-age=172800, public, must-revalidate"
  </filesMatch>
  <filesMatch "\.(html|htm|php)$">
  Header set Cache-Control "max-age=172800, private, must-revalidate"
  </filesMatch>
  </ifModule>

  <IfModule mod_setenvif.c>
  BrowserMatch "MSIE" force-no-vary
  BrowserMatch "Mozilla/4.[0-9]{2}" force-no-vary
</IfModule>

<IfModule mod_dir.c>
	DirectoryIndex index.php index.html
</IfModule>

<IfModule mod_expires.c>
	ExpiresActive on
	ExpiresByType image/jpeg "access plus 3 day"
	ExpiresByType image/gif "access plus 3 day"
</IfModule>